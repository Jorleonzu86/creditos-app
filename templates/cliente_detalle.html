{% extends "base.html" %}

{% block title %}Detalle de cliente{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Cliente: {{ cliente.nombre }}</h2>
  <div>
    <a href="{{ url_for('cliente_pdf', cliente_id=cliente.id) }}" class="btn btn-outline-secondary btn-sm me-2">
      Descargar PDF
    </a>
    <a href="{{ url_for('clientes') }}" class="btn btn-secondary btn-sm">
      ← Volver a la lista
    </a>
  </div>
</div>

<div class="card mb-4">
  <div class="card-body">
    <p><strong>Teléfono:</strong> {{ cliente.telefono or "No registrado" }}</p>
    <p><strong>Saldo actual:</strong> ₡{{ "%.2f"|format(cliente.saldo or 0) }}</p>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-header">
        <strong>Registrar movimiento</strong>
      </div>
      <div class="card-body">
        <form method="post" action="{{ url_for('cliente_detalle', cliente_id=cliente.id) }}">
          <div class="mb-3">
            <label class="form-label">Tipo de movimiento</label>
            <select name="tipo" class="form-select" required>
              <option value="COMPRA">COMPRA (aumenta deuda)</option>
              <option value="ABONO">ABONO (disminuye deuda)</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Monto (₡)</label>
            <input type="number" step="0.01" min="0" name="monto" class="form-control" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Fecha</label>
            <input type="date"
                   name="fecha"
                   class="form-control"
                   value="{{ date.today().isoformat() }}">
          </div>

          <div class="mb-3">
            <label class="form-label">Descripción (opcional)</label>
            <input type="text" name="descripcion" class="form-control"
                   placeholder="Ej: compra de ropa, abono en efectivo">
          </div>

          <button type="submit" class="btn btn-primary">Guardar movimiento</button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-header">
        <strong>Historial de movimientos</strong>
      </div>
      <div class="card-body">
        {% if movimientos %}
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Monto</th>
                <th>Descripción</th>
              </tr>
            </thead>
            <tbody>
              {% for mov in movimientos %}
                <tr>
                  <td>{{ mov.fecha.strftime("%d/%m/%Y") if mov.fecha else "" }}</td>
                  <td>
                    {% if mov.tipo == "COMPRA" %}
                      <span class="badge bg-danger">COMPRA</span>
                    {% else %}
                      <span class="badge bg-success">ABONO</span>
                    {% endif %}
                  </td>
                  <td>₡{{ "%.2f"|format(mov.monto) }}</td>
                  <td>{{ mov.descripcion or "" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="text-muted">Aún no hay movimientos para este cliente.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

